/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var jrc = ee.Image("JRC/GSW1_3/GlobalSurfaceWater"),
    geometry = 
    /* color: #98ff00 */
    /* shown: false */
    ee.Geometry.Point([-120.15028283672935, 39.38102011786368]),
    alos = ee.ImageCollection("JAXA/ALOS/AW3D30/V3_2"),
    waterOccurrence = ee.Image("users/gena/water-occurrence-ProsserCreek-2000-01-01_2017-04-01"),
    ned = ee.Image("USGS/NED"),
    geom = 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.MultiPolygon(
        [[[[-120.17554019938399, 39.387583426639054],
           [-120.17549728403975, 39.38762634198329],
           [-120.17554019938399, 39.38762634198329],
           [-120.17554019938399, 39.387583426639054]]],
         [[[-120.17549728403975, 39.39015834729335],
           [-120.17545436869551, 39.39020126263759],
           [-120.17549728403975, 39.39020126263759],
           [-120.17549728403975, 39.39015834729335]]],
         [[[-120.17463897715498, 39.38693969647548],
           [-120.17459606181075, 39.38698261181972],
           [-120.17463897715498, 39.38698261181972],
           [-120.17463897715498, 39.38693969647548]]],
         [[[-120.17455314646651, 39.386853865787],
           [-120.17451023112227, 39.38689678113124],
           [-120.17455314646651, 39.38689678113124],
           [-120.17455314646651, 39.386853865787]]],
         [[[-120.1744244004338, 39.38638179700038],
           [-120.17438148508955, 39.38642471234462],
           [-120.1744244004338, 39.38642471234462],
           [-120.1744244004338, 39.38638179700038]]],
         [[[-120.17438148508955, 39.38612430493495],
           [-120.17433856974532, 39.38616722027919],
           [-120.17438148508955, 39.38616722027919],
           [-120.17438148508955, 39.38612430493495]]],
         [[[-120.17425273905684, 39.389042548343156],
           [-120.1742098237126, 39.389085463687394],
           [-120.17425273905684, 39.389085463687394],
           [-120.17425273905684, 39.389042548343156]]],
         [[[-120.17373775492598, 39.3888708869662],
           [-120.17369483958174, 39.38891380231044],
           [-120.17373775492598, 39.38891380231044],
           [-120.17373775492598, 39.3888708869662]]],
         [[[-120.17266487132002, 39.38818424145839],
           [-120.17262195597579, 39.38827007214687],
           [-120.17266487132002, 39.38827007214687],
           [-120.17266487132002, 39.38818424145839]]],
         [[[-120.17266487132002, 39.37513797680995],
           [-120.17262195597579, 39.37518089215419],
           [-120.17266487132002, 39.37518089215419],
           [-120.17266487132002, 39.37513797680995]]],
         [[[-120.17253612528731, 39.37500923077724],
           [-120.17249320994307, 39.375052146121476],
           [-120.17253612528731, 39.375052146121476],
           [-120.17253612528731, 39.37500923077724]]],
         [[[-120.17180656443526, 39.38470809857509],
           [-120.1718494797795, 39.384793929263566],
           [-120.17180656443526, 39.38475101391933],
           [-120.17180656443526, 39.38470809857509]]],
         [[[-120.17137741099287, 39.3874117652621],
           [-120.17133449564864, 39.38745468060634],
           [-120.17137741099287, 39.38745468060634],
           [-120.17137741099287, 39.3874117652621]]],
         [[[-120.17116283427168, 39.37363593976161],
           [-120.17124866496016, 39.37372177045009],
           [-120.17116283427168, 39.37367885510585],
           [-120.17116283427168, 39.37363593976161]]],
         [[[-120.17103408823897, 39.38316314618251],
           [-120.17099117289473, 39.38324897687099],
           [-120.17103408823897, 39.38324897687099],
           [-120.17103408823897, 39.38316314618251]]],
         [[[-120.17086242686202, 39.38363521496913],
           [-120.17090534220625, 39.38376396100185],
           [-120.17086242686202, 39.38372104565761],
           [-120.17086242686202, 39.38363521496913]]],
         [[[-120.17000411997725, 39.3824765006747],
           [-120.16996120463301, 39.38251941601894],
           [-120.17000411997725, 39.38251941601894],
           [-120.17000411997725, 39.3824765006747]]],
         [[[-120.1698324586003, 39.38638179700038],
           [-120.16978954325606, 39.38642471234462],
           [-120.1698324586003, 39.38642471234462],
           [-120.1698324586003, 39.38638179700038]]],
         [[[-120.16931747446944, 39.37573879162929],
           [-120.16923164378096, 39.37578170697353],
           [-120.16931747446944, 39.37578170697353],
           [-120.16931747446944, 39.37573879162929]]],
         [[[-120.16905998240401, 39.38213317792079],
           [-120.16901706705977, 39.38217609326503],
           [-120.16905998240401, 39.38217609326503],
           [-120.16905998240401, 39.38213317792079]]],
         [[[-120.16807292948653, 39.38573806683681],
           [-120.16803001414229, 39.385780982181046],
           [-120.16807292948653, 39.385780982181046],
           [-120.16807292948653, 39.38573806683681]]],
         [[[-120.16803001414229, 39.37513797680995],
           [-120.16798709879805, 39.37518089215419],
           [-120.16803001414229, 39.37518089215419],
           [-120.16803001414229, 39.37513797680995]]],
         [[[-120.16738628397871, 39.3810173789706],
           [-120.16730045329024, 39.381060294314835],
           [-120.16738628397871, 39.381060294314835],
           [-120.16738628397871, 39.3810173789706]]],
         [[[-120.16738628397871, 39.37196224133632],
           [-120.16730045329024, 39.37200515668056],
           [-120.16738628397871, 39.37200515668056],
           [-120.16738628397871, 39.37196224133632]]],
         [[[-120.16622756968428, 39.371576003238175],
           [-120.16618465434004, 39.37161891858241],
           [-120.16622756968428, 39.37161891858241],
           [-120.16622756968428, 39.371576003238175]]],
         [[[-120.16575550089766, 39.371361426516984],
           [-120.16571258555342, 39.37140434186122],
           [-120.16575550089766, 39.37140434186122],
           [-120.16575550089766, 39.371361426516984]]],
         [[[-120.16545509348799, 39.37114684979579],
           [-120.16536926279952, 39.37118976514003],
           [-120.16545509348799, 39.37118976514003],
           [-120.16545509348799, 39.37114684979579]]],
         [[[-120.16481136332442, 39.369859389468644],
           [-120.16476844798018, 39.36994522015712],
           [-120.16481136332442, 39.36994522015712],
           [-120.16481136332442, 39.369859389468644]]],
         [[[-120.16455387125899, 39.36938732068202],
           [-120.16451095591475, 39.36943023602626],
           [-120.16455387125899, 39.36943023602626],
           [-120.16455387125899, 39.36938732068202]]],
         [[[-120.16438220988204, 39.36921565930507],
           [-120.1643392945378, 39.36925857464931],
           [-120.16438220988204, 39.36925857464931],
           [-120.16438220988204, 39.36921565930507]]],
         [[[-120.16416763316084, 39.37372177045009],
           [-120.1641247178166, 39.373807601138566],
           [-120.16416763316084, 39.373807601138566],
           [-120.16416763316084, 39.37372177045009]]],
         [[[-120.16356681834151, 39.38492267529628],
           [-120.16339515696455, 39.38496559064052],
           [-120.16356681834151, 39.38496559064052],
           [-120.16356681834151, 39.38492267529628]]],
         [[[-120.1632234955876, 39.36775653760097],
           [-120.1628801728337, 39.367842368289445],
           [-120.1626655961125, 39.36814277569911],
           [-120.16227935801436, 39.368357352420304],
           [-120.16219352732588, 39.36917274396083],
           [-120.16185020457198, 39.36964481274745],
           [-120.16137813578536, 39.369859389468644],
           [-120.16073440562178, 39.369859389468644],
           [-120.16000484476973, 39.36964481274745],
           [-120.15923236857344, 39.36964481274745],
           [-120.15897487650801, 39.369816474124406],
           [-120.15858863840987, 39.369859389468644],
           [-120.15858863840987, 39.36994522015712],
           [-120.15824531565596, 39.36998813550136],
           [-120.15725826273848, 39.37050311963222],
           [-120.15691493998457, 39.37071769635341],
           [-120.15678619395186, 39.3709322730746],
           [-120.15657161723067, 39.37097518841884],
           [-120.15597080241133, 39.37140434186122],
           [-120.15545581828047, 39.371576003238175],
           [-120.1545975113957, 39.37213390271327],
           [-120.15412544260909, 39.37273471753261],
           [-120.15395378123213, 39.37316387097499],
           [-120.15378211985518, 39.37324970166347],
           [-120.15348171244551, 39.37393634717128],
           [-120.15373920451094, 39.37475173871181],
           [-120.15373920451094, 39.37543838421962],
           [-120.15356754313399, 39.37599628369472],
           [-120.1531383896916, 39.37651126782558],
           [-120.1527950669377, 39.37724082867763],
           [-120.15228008280684, 39.377841643496964],
           [-120.15150760661055, 39.37814205090663],
           [-120.15052055369307, 39.37814205090663],
           [-120.14979099284102, 39.37792747418544],
           [-120.14773105631758, 39.377798728152726],
           [-120.1469585801213, 39.37766998212001],
           [-120.14682983408858, 39.37749832074306],
           [-120.14605735789229, 39.37724082867763],
           [-120.14567111979414, 39.37694042126796],
           [-120.14498447428633, 39.37711208264491],
           [-120.14425491343428, 39.377541236087296],
           [-120.14391159068037, 39.377584151431535],
           [-120.14391159068037, 39.37766998212001],
           [-120.14318202982832, 39.37766998212001],
           [-120.14318202982832, 39.377584151431535],
           [-120.1429245377629, 39.377584151431535],
           [-120.14258121500899, 39.37736957471034],
           [-120.14219497691084, 39.37728374402187],
           [-120.1409075165837, 39.37728374402187],
           [-120.14030670176436, 39.377584151431535],
           [-120.13850425730635, 39.37912910382411],
           [-120.13798927317549, 39.37942951123378],
           [-120.13790344248702, 39.379601172610734],
           [-120.13717388163496, 39.38003032605312],
           [-120.13717388163496, 39.38041656415126],
           [-120.13773178111006, 39.38088863293788],
           [-120.13807510386397, 39.38174693982265],
           [-120.1383325959294, 39.3819186011996],
           [-120.13936256419112, 39.38221900860927],
           [-120.13966297160079, 39.38251941601894],
           [-120.14017795573164, 39.38260524670741],
           [-120.14030670176436, 39.38273399274013],
           [-120.14077877055098, 39.38286273877284],
           [-120.14107917796065, 39.38312023083827],
           [-120.14120792399336, 39.38367813031337],
           [-120.14189456950118, 39.38440769116542],
           [-120.1423666382878, 39.38423602978847],
           [-120.14279579173018, 39.38423602978847],
           [-120.14386867533614, 39.38475101391933],
           [-120.1441690827458, 39.38535182873866],
           [-120.14408325205733, 39.38590972821376],
           [-120.14434074412276, 39.386038474246476],
           [-120.144383659467, 39.386596373721574],
           [-120.1447269822209, 39.387025527163956],
           [-120.1447269822209, 39.38814132611415],
           [-120.14489864359786, 39.38844173352382],
           [-120.14597152720381, 39.388312987491105],
           [-120.14610027323653, 39.38818424145839],
           [-120.14657234202315, 39.38827007214687],
           [-120.14665817271162, 39.38818424145839],
           [-120.1467440034001, 39.388312987491105],
           [-120.14734481821944, 39.38848464886806],
           [-120.14773105631758, 39.3888708869662],
           [-120.14824604044844, 39.38899963299892],
           [-120.14880393992354, 39.38947170178554],
           [-120.14919017802168, 39.3894287864413],
           [-120.1493189240544, 39.389300040408585],
           [-120.14927600871016, 39.38818424145839],
           [-120.1484177018254, 39.38719718854091],
           [-120.14798854838301, 39.38693969647548],
           [-120.14790271769454, 39.38672511975429],
           [-120.14798854838301, 39.38642471234462],
           [-120.14871810923506, 39.38612430493495],
           [-120.1487610245793, 39.38573806683681],
           [-120.14833187113692, 39.38526599805019],
           [-120.14773105631758, 39.385051421328996],
           [-120.14717315684248, 39.384579352542374],
           [-120.14691566477705, 39.3844935218539],
           [-120.14610027323653, 39.38367813031337],
           [-120.14610027323653, 39.38324897687099],
           [-120.14635776530196, 39.38312023083827],
           [-120.14665817271162, 39.38312023083827],
           [-120.14665817271162, 39.383034400149796],
           [-120.14768814097334, 39.38324897687099],
           [-120.1482031251042, 39.38346355359218],
           [-120.14991973887373, 39.38363521496913],
           [-120.15155052195479, 39.38419311444423],
           [-120.15197967539717, 39.38419311444423],
           [-120.1524517441838, 39.38389270703456],
           [-120.15331005106856, 39.38389270703456],
           [-120.15399669657637, 39.38402145306728],
           [-120.15429710398604, 39.38419311444423],
           [-120.15562747965743, 39.384278945132706],
           [-120.15678619395186, 39.38500850598476],
           [-120.15760158549239, 39.385823897525285],
           [-120.15841697703291, 39.387283019229386],
           [-120.15871738444258, 39.38745468060634],
           [-120.15897487650801, 39.387798003360246],
           [-120.16000484476973, 39.38839881817958],
           [-120.16090606699873, 39.38848464886806],
           [-120.16150688181807, 39.388785056277726],
           [-120.16193603526045, 39.38874214093349],
           [-120.1617643738835, 39.3879696647372],
           [-120.16137813578536, 39.38766925732753],
           [-120.16051982890059, 39.387283019229386],
           [-120.15983318339278, 39.386596373721574],
           [-120.1597473527043, 39.38625305096767],
           [-120.15948986063887, 39.38599555890224],
           [-120.15944694529463, 39.38543765942714],
           [-120.15957569132735, 39.38535182873866],
           [-120.1600906754582, 39.38535182873866],
           [-120.1600906754582, 39.38526599805019],
           [-120.16073440562178, 39.38492267529628],
           [-120.16185020457198, 39.384836844607804],
           [-120.16292308817793, 39.38500850598476],
           [-120.16356681834151, 39.38492267529628],
           [-120.1643392945378, 39.38522308270595],
           [-120.16528343211104, 39.38526599805019],
           [-120.16536926279952, 39.3853947440829],
           [-120.16571258555342, 39.38543765942714],
           [-120.16631340037276, 39.38535182873866],
           [-120.16747211466719, 39.38543765942714],
           [-120.16880249033858, 39.38616722027919],
           [-120.1696178818791, 39.38625305096767],
           [-120.1696178818791, 39.386338881656144],
           [-120.1698324586003, 39.38638179700038],
           [-120.1707336808293, 39.38698261181972],
           [-120.17094825755049, 39.387283019229386],
           [-120.17137741099287, 39.3874117652621],
           [-120.17180656443526, 39.38788383404872],
           [-120.17266487132002, 39.38818424145839],
           [-120.1730940247624, 39.38865631024501],
           [-120.17352317820479, 39.3888708869662],
           [-120.17399524699141, 39.38891380231044],
           [-120.17425273905684, 39.389042548343156],
           [-120.17429565440108, 39.38925712506435],
           [-120.1747677231877, 39.38972919385097],
           [-120.17541145335127, 39.390072516604874],
           [-120.17575477610518, 39.39041583935878],
           [-120.17618392954756, 39.390544585391496],
           [-120.17665599833418, 39.39114540021083],
           [-120.17742847453047, 39.39135997693202],
           [-120.17742847453047, 39.391059569522355],
           [-120.17717098246504, 39.390544585391496],
           [-120.17742847453047, 39.39037292401454],
           [-120.17751430521895, 39.3899866859164],
           [-120.17777179728438, 39.389815024539445],
           [-120.17760013590743, 39.38938587109706],
           [-120.17699932108809, 39.388785056277726],
           [-120.1767847443669, 39.38874214093349],
           [-120.17631267558028, 39.38818424145839],
           [-120.17549728403975, 39.38762634198329],
           [-120.17515396128584, 39.38711135785243],
           [-120.17451023112227, 39.38689678113124],
           [-120.1744244004338, 39.38625305096767],
           [-120.17412399302412, 39.385780982181046],
           [-120.1738665009587, 39.38565223614833],
           [-120.17343734751631, 39.38565223614833],
           [-120.17180656443526, 39.384793929263566],
           [-120.17150615702559, 39.38415019909999],
           [-120.17124866496016, 39.38389270703456],
           [-120.17081951151778, 39.38372104565761],
           [-120.17103408823897, 39.38346355359218],
           [-120.17103408823897, 39.38312023083827],
           [-120.17081951151778, 39.38277690808437],
           [-120.16996120463301, 39.38251941601894],
           [-120.16974662791182, 39.382304839297746],
           [-120.16901706705977, 39.38217609326503],
           [-120.16824459086348, 39.38166110913417],
           [-120.16803001414229, 39.381317786380265],
           [-120.16751503001143, 39.381060294314835],
           [-120.16657089243819, 39.380802802249406],
           [-120.16511177073409, 39.380588225528214],
           [-120.16459678660323, 39.380330733462785],
           [-120.16279434214522, 39.38011615674159],
           [-120.16077732096602, 39.38024490277431],
           [-120.15880321513106, 39.38020198743007],
           [-120.15845989237715, 39.380287818118546],
           [-120.1577303315251, 39.38015907208583],
           [-120.15747283945967, 39.37985866467616],
           [-120.15704368601729, 39.3799015800204],
           [-120.15678619395186, 39.38011615674159],
           [-120.156271209821, 39.38011615674159],
           [-120.15476917277266, 39.379300765201066],
           [-120.1551554108708, 39.37822788159511],
           [-120.15545581828047, 39.377841643496964],
           [-120.15549873362471, 39.37749832074306],
           [-120.15588497172286, 39.37715499798915],
           [-120.15631412516524, 39.376296691104386],
           [-120.15670036326338, 39.37591045300624],
           [-120.1577303315251, 39.37543838421962],
           [-120.15914653788496, 39.3755242149081],
           [-120.15944694529463, 39.37539546887538],
           [-120.15983318339278, 39.37539546887538],
           [-120.1606485749333, 39.375567130252335],
           [-120.16103481303145, 39.375824622317765],
           [-120.1621076966374, 39.37595336835048],
           [-120.16275142680098, 39.37616794507167],
           [-120.16283725748946, 39.37595336835048],
           [-120.16270851145674, 39.3755242149081],
           [-120.16206478129317, 39.375052146121476],
           [-120.16189311991621, 39.37445133130214],
           [-120.16279434214522, 39.37419383923671],
           [-120.1632234955876, 39.37419383923671],
           [-120.1634380723088, 39.37402217785976],
           [-120.16408180247237, 39.373850516482804],
           [-120.1641247178166, 39.37372177045009],
           [-120.16459678660323, 39.37372177045009],
           [-120.16459678660323, 39.373807601138566],
           [-120.16498302470137, 39.373850516482804],
           [-120.16532634745528, 39.37427966992519],
           [-120.16566967020918, 39.37449424664638],
           [-120.16605590830733, 39.374580077334855],
           [-120.16627048502852, 39.374794654056046],
           [-120.16738628397871, 39.37488048474452],
           [-120.1676008606999, 39.375052146121476],
           [-120.16863082896162, 39.37539546887538],
           [-120.1696178818791, 39.37595336835048],
           [-120.17051910410811, 39.37625377576015],
           [-120.17180656443526, 39.376339606448624],
           [-120.17236446391036, 39.37612502972743],
           [-120.17287944804121, 39.37573879162929],
           [-120.17292236338545, 39.37548129956386],
           [-120.17249320994307, 39.375052146121476],
           [-120.1724073792546, 39.374580077334855],
           [-120.17197822581221, 39.374322585269425],
           [-120.1716349030583, 39.37389343182704],
           [-120.17116283427168, 39.37372177045009],
           [-120.17026161204268, 39.3729492942538],
           [-120.16974662791182, 39.372863463565324],
           [-120.16966079722334, 39.37273471753261],
           [-120.16918872843672, 39.372605971499894],
           [-120.16875957499434, 39.372348479434464],
           [-120.16807292948653, 39.37226264874599],
           [-120.16755794535567, 39.37200515668056],
           [-120.1669142151921, 39.37187641064784],
           [-120.1666996384709, 39.37170474927089],
           [-120.16618465434004, 39.37161891858241],
           [-120.16536926279952, 39.37118976514003],
           [-120.16528343211104, 39.370588950320695],
           [-120.16476844798018, 39.36994522015712],
           [-120.16463970194746, 39.36951606671474],
           [-120.1643392945378, 39.36925857464931],
           [-120.16399597178389, 39.36840026776454],
           [-120.1632234955876, 39.36775653760097]]],
         [[[-120.16283725748946, 39.37591045300624],
           [-120.16279434214522, 39.37595336835048],
           [-120.16283725748946, 39.37595336835048],
           [-120.16283725748946, 39.37591045300624]]],
         [[[-120.16283725748946, 39.37612502972743],
           [-120.16275142680098, 39.37616794507167],
           [-120.16283725748946, 39.37616794507167],
           [-120.16283725748946, 39.37612502972743]]],
         [[[-120.16257976542403, 39.376082114383195],
           [-120.16249393473555, 39.37612502972743],
           [-120.16257976542403, 39.37612502972743],
           [-120.16257976542403, 39.376082114383195]]],
         [[[-120.1621076966374, 39.37500923077724],
           [-120.16206478129317, 39.375052146121476],
           [-120.1621076966374, 39.375052146121476],
           [-120.1621076966374, 39.37500923077724]]],
         [[[-120.16197895060469, 39.37445133130214],
           [-120.16189311991621, 39.374580077334855],
           [-120.16197895060469, 39.37449424664638],
           [-120.16197895060469, 39.37445133130214]]],
         [[[-120.16189311991621, 39.369558982058976],
           [-120.16180728922774, 39.36964481274745],
           [-120.16189311991621, 39.369601897403214],
           [-120.16189311991621, 39.369558982058976]]],
         [[[-120.16172145853926, 39.38792674939296],
           [-120.16167854319502, 39.3879696647372],
           [-120.16172145853926, 39.3879696647372],
           [-120.16172145853926, 39.38792674939296]]],
         [[[-120.16094898234297, 39.38745468060634],
           [-120.16090606699873, 39.38749759595058],
           [-120.16094898234297, 39.38749759595058],
           [-120.16094898234297, 39.38745468060634]]],
         [[[-120.16073440562178, 39.38844173352382],
           [-120.16069149027754, 39.38848464886806],
           [-120.16073440562178, 39.38848464886806],
           [-120.16073440562178, 39.38844173352382]]],
         [[[-120.1606485749333, 39.38496559064052],
           [-120.16056274424483, 39.38500850598476],
           [-120.1606485749333, 39.38500850598476],
           [-120.1606485749333, 39.38496559064052]]],
         [[[-120.16047691355635, 39.385051421328996],
           [-120.16043399821211, 39.385094336673234],
           [-120.16047691355635, 39.385094336673234],
           [-120.16047691355635, 39.385051421328996]]],
         [[[-120.15957569132735, 39.386081389590714],
           [-120.15953277598311, 39.38612430493495],
           [-120.15957569132735, 39.38612430493495],
           [-120.15957569132735, 39.386081389590714]]],
         [[[-120.15953277598311, 39.3853947440829],
           [-120.15944694529463, 39.38548057477138],
           [-120.15953277598311, 39.38543765942714],
           [-120.15953277598311, 39.3853947440829]]],
         [[[-120.15948986063887, 39.37539546887538],
           [-120.15944694529463, 39.37543838421962],
           [-120.15948986063887, 39.37543838421962],
           [-120.15948986063887, 39.37539546887538]]],
         [[[-120.15927528391768, 39.37543838421962],
           [-120.15923236857344, 39.37548129956386],
           [-120.15927528391768, 39.37548129956386],
           [-120.15927528391768, 39.37543838421962]]],
         [[[-120.15897487650801, 39.36977355878017],
           [-120.15893196116377, 39.369816474124406],
           [-120.15897487650801, 39.369816474124406],
           [-120.15897487650801, 39.36977355878017]]],
         [[[-120.15854572306563, 39.38024490277431],
           [-120.15845989237715, 39.380287818118546],
           [-120.15854572306563, 39.380287818118546],
           [-120.15854572306563, 39.38024490277431]]],
         [[[-120.15837406168868, 39.37543838421962],
           [-120.1582882310002, 39.37548129956386],
           [-120.15837406168868, 39.37548129956386],
           [-120.15837406168868, 39.37543838421962]]],
         [[[-120.1582882310002, 39.38689678113124],
           [-120.15824531565596, 39.38693969647548],
           [-120.1582882310002, 39.38693969647548],
           [-120.1582882310002, 39.38689678113124]]],
         [[[-120.1577303315251, 39.380073241397355],
           [-120.15764450083662, 39.38011615674159],
           [-120.15777324686934, 39.38015907208583],
           [-120.1577303315251, 39.380073241397355]]],
         [[[-120.15725826273848, 39.375610045596574],
           [-120.15721534739424, 39.37565296094081],
           [-120.15725826273848, 39.37565296094081],
           [-120.15725826273848, 39.375610045596574]]],
         [[[-120.15622829447676, 39.37651126782558],
           [-120.15618537913252, 39.376554183169816],
           [-120.15622829447676, 39.376554183169816],
           [-120.15622829447676, 39.37651126782558]]],
         [[[-120.15597080241133, 39.371361426516984],
           [-120.1559278870671, 39.37140434186122],
           [-120.15597080241133, 39.37140434186122],
           [-120.15597080241133, 39.371361426516984]]],
         [[[-120.1559278870671, 39.38440769116542],
           [-120.15588497172286, 39.38445060650966],
           [-120.1559278870671, 39.38445060650966],
           [-120.1559278870671, 39.38440769116542]]],
         [[[-120.15554164896895, 39.37749832074306],
           [-120.15549873362471, 39.377541236087296],
           [-120.15554164896895, 39.377541236087296],
           [-120.15554164896895, 39.37749832074306]]],
         [[[-120.15511249552657, 39.37942951123378],
           [-120.15506958018233, 39.37947242657802],
           [-120.15511249552657, 39.37947242657802],
           [-120.15511249552657, 39.37942951123378]]],
         [[[-120.15489791880537, 39.37891452710292],
           [-120.15485500346114, 39.37895744244716],
           [-120.15489791880537, 39.37895744244716],
           [-120.15489791880537, 39.37891452710292]]],
         [[[-120.15485500346114, 39.37921493451259],
           [-120.15476917277266, 39.379300765201066],
           [-120.15485500346114, 39.379300765201066],
           [-120.15485500346114, 39.37921493451259]]],
         [[[-120.15429710398604, 39.372563056155656],
           [-120.1542541886418, 39.372605971499894],
           [-120.15429710398604, 39.372605971499894],
           [-120.15429710398604, 39.372563056155656]]],
         [[[-120.15361045847823, 39.37372177045009],
           [-120.15356754313399, 39.373807601138566],
           [-120.15361045847823, 39.373807601138566],
           [-120.15361045847823, 39.37372177045009]]],
         [[[-120.1527950669377, 39.37719791333339],
           [-120.15275215159346, 39.37724082867763],
           [-120.1527950669377, 39.37724082867763],
           [-120.1527950669377, 39.37719791333339]]],
         [[[-120.17755722056319, 39.3899866859164],
           [-120.17751430521895, 39.390029601260636],
           [-120.17755722056319, 39.390029601260636],
           [-120.17755722056319, 39.3899866859164]]],
         [[[-120.15180801402022, 39.37801330487392],
           [-120.15176509867598, 39.378056220218156],
           [-120.15180801402022, 39.378056220218156],
           [-120.15180801402022, 39.37801330487392]]],
         [[[-120.17742847453047, 39.38921420972011],
           [-120.17747138987471, 39.389300040408585],
           [-120.17742847453047, 39.38925712506435],
           [-120.17742847453047, 39.38921420972011]]],
         [[[-120.17725681315352, 39.39050167004726],
           [-120.17717098246504, 39.390587500735734],
           [-120.17725681315352, 39.390544585391496],
           [-120.17725681315352, 39.39050167004726]]],
         [[[-120.17721389780928, 39.39063041607997],
           [-120.17717098246504, 39.39067333142421],
           [-120.17721389780928, 39.39067333142421],
           [-120.17721389780928, 39.39063041607997]]],
         [[[-120.14867519389082, 39.38612430493495],
           [-120.14863227854659, 39.38616722027919],
           [-120.14867519389082, 39.38616722027919],
           [-120.14867519389082, 39.38612430493495]]],
         [[[-120.14863227854659, 39.385566405459855],
           [-120.14858936320235, 39.38560932080409],
           [-120.14863227854659, 39.38560932080409],
           [-120.14863227854659, 39.385566405459855]]],
         [[[-120.14850353251387, 39.38621013562343],
           [-120.14846061716963, 39.38625305096767],
           [-120.14850353251387, 39.38625305096767],
           [-120.14850353251387, 39.38621013562343]]],
         [[[-120.14850353251387, 39.38921420972011],
           [-120.14846061716963, 39.38925712506435],
           [-120.14850353251387, 39.38925712506435],
           [-120.14850353251387, 39.38921420972011]]],
         [[[-120.14828895579268, 39.38625305096767],
           [-120.14824604044844, 39.386338881656144],
           [-120.14828895579268, 39.386338881656144],
           [-120.14828895579268, 39.38625305096767]]],
         [[[-120.14824604044844, 39.38899963299892],
           [-120.1482031251042, 39.389042548343156],
           [-120.14824604044844, 39.389042548343156],
           [-120.14824604044844, 39.38899963299892]]],
         [[[-120.1482031251042, 39.387068442508195],
           [-120.14816020975996, 39.38711135785243],
           [-120.1482031251042, 39.38711135785243],
           [-120.1482031251042, 39.387068442508195]]],
         [[[-120.14798854838301, 39.386810950442765],
           [-120.14794563303877, 39.386853865787],
           [-120.14798854838301, 39.386853865787],
           [-120.14798854838301, 39.386810950442765]]],
         [[[-120.14794563303877, 39.38668220441005],
           [-120.14790271769454, 39.38672511975429],
           [-120.14794563303877, 39.38672511975429],
           [-120.14794563303877, 39.38668220441005]]],
         [[[-120.14794563303877, 39.3865105430331],
           [-120.14790271769454, 39.386553458377335],
           [-120.14794563303877, 39.386553458377335],
           [-120.14794563303877, 39.3865105430331]]],
         [[[-120.14743064890791, 39.384793929263566],
           [-120.14738773356368, 39.384836844607804],
           [-120.14743064890791, 39.384836844607804],
           [-120.14743064890791, 39.384793929263566]]],
         [[[-120.14734481821944, 39.38848464886806],
           [-120.1473019028752, 39.388527564212296],
           [-120.14734481821944, 39.388527564212296],
           [-120.14734481821944, 39.38848464886806]]],
         [[[-120.14717315684248, 39.38839881817958],
           [-120.14713024149825, 39.38844173352382],
           [-120.14717315684248, 39.38844173352382],
           [-120.14717315684248, 39.38839881817958]]],
         [[[-120.14682983408858, 39.383034400149796],
           [-120.14665817271162, 39.383077315494035],
           [-120.14682983408858, 39.383077315494035],
           [-120.14682983408858, 39.383034400149796]]],
         [[[-120.14665817271162, 39.38818424145839],
           [-120.14657234202315, 39.38827007214687],
           [-120.14665817271162, 39.38827007214687],
           [-120.14665817271162, 39.38818424145839]]],
         [[[-120.14644359599043, 39.38402145306728],
           [-120.14648651133467, 39.38410728375575],
           [-120.14644359599043, 39.384064368411515],
           [-120.14644359599043, 39.38402145306728]]],
         [[[-120.14627193461348, 39.38316314618251],
           [-120.14622901926924, 39.38320606152675],
           [-120.14627193461348, 39.38320606152675],
           [-120.14627193461348, 39.38316314618251]]],
         [[[-120.14622901926924, 39.38372104565761],
           [-120.146186103925, 39.38376396100185],
           [-120.14622901926924, 39.38376396100185],
           [-120.14622901926924, 39.38372104565761]]],
         [[[-120.14622901926924, 39.38818424145839],
           [-120.14610027323653, 39.38818424145839],
           [-120.14610027323653, 39.38827007214687],
           [-120.14622901926924, 39.38827007214687],
           [-120.14622901926924, 39.38818424145839]]],
         [[[-120.146186103925, 39.38324897687099],
           [-120.14610027323653, 39.383291892215226],
           [-120.146186103925, 39.383291892215226],
           [-120.146186103925, 39.38324897687099]]],
         [[[-120.14588569651534, 39.377069167300675],
           [-120.1458427811711, 39.37711208264491],
           [-120.14588569651534, 39.37711208264491],
           [-120.14588569651534, 39.377069167300675]]],
         [[[-120.17682765971114, 39.38869922558925],
           [-120.1767847443669, 39.38874214093349],
           [-120.17682765971114, 39.38874214093349],
           [-120.17682765971114, 39.38869922558925]]],
         [[[-120.1447269822209, 39.387025527163956],
           [-120.14468406687666, 39.387068442508195],
           [-120.1447269822209, 39.387068442508195],
           [-120.1447269822209, 39.387025527163956]]],
         [[[-120.14464115153243, 39.377326659366105],
           [-120.14459823618819, 39.37736957471034],
           [-120.14464115153243, 39.37736957471034],
           [-120.14464115153243, 39.377326659366105]]],
         [[[-120.14434074412276, 39.386038474246476],
           [-120.14429782877852, 39.386081389590714],
           [-120.14434074412276, 39.386081389590714],
           [-120.14434074412276, 39.386038474246476]]],
         [[[-120.1441690827458, 39.38535182873866],
           [-120.14412616740157, 39.38543765942714],
           [-120.1441690827458, 39.38543765942714],
           [-120.1441690827458, 39.38535182873866]]],
         [[[-120.14107917796065, 39.38312023083827],
           [-120.14103626261641, 39.38316314618251],
           [-120.14107917796065, 39.38316314618251],
           [-120.14107917796065, 39.38312023083827]]],
         [[[-120.14077877055098, 39.38286273877284],
           [-120.14073585520674, 39.38290565411708],
           [-120.14077877055098, 39.38290565411708],
           [-120.14077877055098, 39.38286273877284]]],
         [[[-120.14017795573164, 39.38260524670741],
           [-120.1401350403874, 39.38264816205165],
           [-120.14017795573164, 39.38264816205165],
           [-120.14017795573164, 39.38260524670741]]],
         [[[-120.14009212504317, 39.377798728152726],
           [-120.14004920969893, 39.377841643496964],
           [-120.14009212504317, 39.377841643496964],
           [-120.14009212504317, 39.377798728152726]]],
         [[[-120.13936256419112, 39.38221900860927],
           [-120.13931964884688, 39.38226192395351],
           [-120.13936256419112, 39.38226192395351],
           [-120.13936256419112, 39.38221900860927]]],
         [[[-120.13936256419112, 39.378356627627824],
           [-120.13931964884688, 39.37839954297206],
           [-120.13936256419112, 39.37839954297206],
           [-120.13936256419112, 39.378356627627824]]],
         [[[-120.13790344248702, 39.379558257266496],
           [-120.13786052714278, 39.379601172610734],
           [-120.13790344248702, 39.379601172610734],
           [-120.13790344248702, 39.379558257266496]]]], null, false),
    geometry2 = 
    /* color: #98ff00 */
    /* shown: false */
    ee.Geometry.Point([-120.17643271494086, 39.39041044062057]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
var imageGallery = require('users/gena/packages:gallery')
var assets = require('users/gena/packages:assets')
var a = require('users/gena/packages:animation')

var draw = function(images, region, rows, columns, scale, options) {
    scale = scale || Map.getScale()
    var options = {proj: 'EPSG:3857', flipX: false, flipY: true }

    var proj = ee.Projection('EPSG:3857', [scale, 0, 0, 0, -scale, 0]);
    var scale = proj.nominalScale();

    var e = ee.ErrorMargin(scale);

    var bounds = region.transform(proj, e).bounds(e, proj);

    var count = ee.Number(columns * rows);

    images = images.limit(count);

    // number of images is less than grid cells
    count = count.min(images.size());

    var ids = ee.List(images.aggregate_array('system:index'));

    var indices = ee.List.sequence(0, count.subtract(1));

    var offsetsX = indices.map(function (i) {
        return ee.Number(i).mod(columns);
    });
    var offsetsY = indices.map(function (i) {
        return ee.Number(i).divide(columns).floor();
    });

    var offsets = offsetsX.zip(offsetsY);

    var offsetByImage = ee.Dictionary.fromLists(ids, offsets);

    var coords = ee.List(bounds.coordinates().get(0));

    var w = ee.Number(ee.List(coords.get(1)).get(0)).subtract(ee.List(coords.get(0)).get(0));
    var h = ee.Number(ee.List(coords.get(2)).get(1)).subtract(ee.List(coords.get(0)).get(1));

    var boundsImage = ee.Image().toInt().paint(bounds, 1).reproject(proj);

    // new region
    var ll = ee.List(coords.get(0));
    var ur = [ee.Number(ll.get(0)).add(w.multiply(columns)), ee.Number(ll.get(1)).add(h.multiply(rows))];

    var regionNew = ee.Geometry.Rectangle([ll, ur], proj, false);

    var mosaic = images.map(function (i) {
        var offset = ee.List(offsetByImage.get(i.get('system:index')));
        var xoff = w.multiply(offset.get(0)).multiply(scale);
        var yoff = h.multiply(offset.get(1)).multiply(scale);

        i = i.mask(boundsImage.multiply(i.mask())).paint(bounds, 0, 1);

        return i.translate(xoff, yoff, 'meters', proj);
    }).mosaic();

    return mosaic;
};

// Map.centerObject(waterOccurrence.geometry())

// convert raster to geometry
// var geom = waterOccurrence.gt(0).reduceToVectors({
//   geometry: bounds, 
//   scale: scale
// })
// geom = geom.geometry().simplify(scale * 3)
// print(geom)
// Map.addLayer(geom)

Map.addLayer(ee.Image(1), { palette: ['000000'] }, 'black', false, 0.5)
Map.addLayer(ee.Image(1), { palette: ['ffffff'] }, 'white', true, 0.5)

var images = assets.getImages(geometry, {
  filter: ee.Filter.date('2017-01-01', '2018-01-01'),
  missions: ['L8', 'L7', 'S2'],
  scale: 100
})

var bounds = waterOccurrence.geometry().bounds().buffer(500).bounds()
Map.addLayer(bounds)

images = images.map(function(i) { 
  return i.set({ label: i.date().format('YYYY-MM-dd').cat(', ').cat(i.get('MISSION')) }).clip(bounds)
})

images = images.sort('system:time_start')

// a.animate(images, { 
//   vis: { min: 0.05, max: 0.3 }, 
//   label: 'label',
//   maxFrames: 100
// })

images = assets.addQualityScore(images, geom)

print(images.first())

print(ui.Chart.feature.histogram(images, 'quality_score', 10))

var modisClouds = ee.Image('users/gena/MODCF_meanannual')
Map.addLayer(modisClouds, {}, 'cloud frequency', false)

var scale = Map.getScale()

var bands = ['swir', 'nir', 'blue']

images = images.select(bands)

// add image gallery
var options = {proj: 'EPSG:3857', flipX: false, flipY: true }
var rows = 5, columns = 20
var gallery = draw(images, bounds, rows, columns, scale, options)
Map.addLayer(gallery, {bands: bands, min: 0.05, max: 0.3}, 'gallery (false-color)', true);

var excluded = ee.Image().paint(geometry2.buffer(scale * 5), 0).visualize({ palette: ['de2d26'] })

images = images.map(function(i) {
  var score = ee.Image.constant(i.get('quality_score')).float()
  return score.updateMask(score.unitScale(0.3, 0.5)).visualize({ palette: ['ffff00'], min: 0, max: 1 })
  // return i.visualize({min: 0.05, max: 0.3})
  // .blend(score.updateMask(score.unitScale(0.3, 0.5)).visualize({ palette: ['ffff00'], min: 0, max: 1 }))
})

var gallery = draw(images, bounds, rows, columns, scale, options)
Map.addLayer(gallery, {}, 'gallery (false-color)', true);



